<script type="text/javascript">
jQuery(function($){
  $(".persona.login").click(function(e){
    e.preventDefault();
  });
  $('.logout').click(function(e){
    if(window.User.provider == "persona"){
      e.preventDefault();
    }
  });
});
</script>

<%
if(user){
%>
  <script type="text/javascript">
    window.User = <%-JSON.stringify(user)%>;
    window.onload = function(){
      var url = new URL(document.URL);
      var socket = new WebSocket("ws://"+url.hostname+":"+4180+"/poop");
    }
  </script>
  <h3>Hello <%=user.username%></h3>
  <a class="logout" href="/auth/logout">Logout</a>
<%
}else{
  console.log(locals);
  console.log("no user");
%><h5>Login</h5>
  <ul><%
  var l = authTypes.length;
  while(l--){
    var provider = authTypes[l];
    %><li><%
    console.log(provider);
    if(provider.html){
      %><%-provider.html%></li><%
      continue;
    }
    %><a class="login <%=provider.name%>" href="/auth/<%=provider.name%>/login" ><%
    if(provider.icon){
      %><img src='/auth/<%=provider.name%>/icon' title='Login with <%=provider.name%>' /><%
    }else{
      %><%=provider.name%><%
    }
    %></a></li><%
  }
%></ul><%
}
%>
